<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æ–‡æ‰“å­—ç·´ç¿’ - v4.5 è¦–è¦ºå¹³è¡¡ç‰ˆ</title>
    <style>
        /* --- é…è‰²ç³»çµ± (ä¿æŒ v4.3 çš„æ·±è‰²è³ªæ„Ÿ) --- */
        :root {
            --bg: #f0f2f5;
            --box: #ffffff;
            --primary: #34495e; 
            --text: #2c3e50;
            --highlight: #e8e8e8; 
            --accent: #e74c3c; 
        }

        /* æŠ¹èŒ¶ (Matcha) */
        [data-theme="matcha"] {
            --bg: #e6e6d1; --box: #fbfbf6; --primary: #556b2f; --text: #3e4a2e; --highlight: #dce2c8;
        }
        /* æ«»èŠ± (Sakura) */
        [data-theme="sakura"] {
            --bg: #f2e6e6; --box: #fffafa; --primary: #b35a6d; --text: #5d3a43; --highlight: #ebd4d8;
        }
        /* è³ªæ„Ÿè— (Blue) */
        [data-theme="blue"] {
            --bg: #dbe4eb; --box: #f5f9fc; --primary: #375a7f; --text: #20354b; --highlight: #cdddec;
        }

        body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; transition: 0.3s; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 800px; background: var(--box); padding: 40px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.05); align-self: center; }

        /* ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• */
        .theme-panel { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 25px; gap: 10px; }
        .color-btn { width: 30px; height: 30px; border-radius: 50%; border: 2px solid rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s; }
        .color-btn:hover { transform: scale(1.1); }
        .btn-default { background-color: #34495e; }
        .btn-matcha { background-color: #556b2f; }
        .btn-sakura { background-color: #b35a6d; }
        .btn-blue { background-color: #375a7f; }

        /* è¨­å®šå€åŸŸ */
        .setup-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary); }
        textarea { width: 100%; height: 150px; padding: 15px; border-radius: 8px; border: 2px solid #ddd; font-size: 16px; box-sizing: border-box; resize: vertical; outline: none; background: #fafafa; color: var(--text); }
        textarea:focus { border-color: var(--primary); background: #fff; }
        input[type="number"] { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #ddd; font-size: 16px; box-sizing: border-box; outline: none; }
        input[type="number"]:focus { border-color: var(--primary); }

        /* ç·´ç¿’é¡¯ç¤ºå€ */
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; color: var(--primary); font-size: 18px; }
        
        #displayArea { 
            font-size: 28px; line-height: 2.8; height: 300px; overflow: hidden; position: relative;
            padding: 20px; border: 2px solid rgba(0,0,0,0.05); border-radius: 10px; margin-bottom: 20px;
            white-space: pre-wrap; word-break: break-all; background: var(--box); box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
        }

        .char-current { background: var(--primary); color: #fff; border-radius: 4px; padding: 2px 0; }
        .char-correct { color: #bbb; }
        .char-wrong { background: var(--accent); color: white; border-radius: 4px; }

        #inputField { width: 100%; height: 60px; font-size: 24px; padding: 10px 15px; border: 2px solid var(--primary); border-radius: 8px; box-sizing: border-box; outline: none; background: var(--box); color: var(--text); }

        /* æŒ‰éˆ•ç¾¤çµ„ (ä¿®æ­£é‡é»ï¼šçµ±ä¸€å¤–è§€) */
        .btn-group { display: flex; gap: 15px; margin-top: 25px; }
        
        .btn { padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.2s; width: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* è®“æ‰€æœ‰åŠŸèƒ½æŒ‰éˆ•éƒ½ä½¿ç”¨ä¸»é¡Œè‰² */
        .btn-main, .btn-retry, .btn-edit { 
            background: var(--primary); 
            color: white; 
        }
        
        /* Hover æ•ˆæœçµ±ä¸€ */
        .btn-main:hover, .btn-retry:hover, .btn-edit:hover { 
            opacity: 0.9; 
            transform: translateY(-2px); /* è¼•å¾®æµ®èµ·æ•ˆæœ */
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        h2 { margin-top: 0; text-align: center; color: var(--primary); letter-spacing: 1px; }
    </style>
</head>
<body>

<div class="container">
    <div class="theme-panel">
        <button class="color-btn btn-default" onclick="changeTheme('default')" title="æ¥µç°¡æ·±ç°"></button>
        <button class="color-btn btn-matcha" onclick="changeTheme('matcha')" title="ç¦ªæ„æŠ¹èŒ¶"></button>
        <button class="color-btn btn-sakura" onclick="changeTheme('sakura')" title="ä¹¾ç‡¥ç«ç‘°"></button>
        <button class="color-btn btn-blue" onclick="changeTheme('blue')" title="è«è˜­è¿ªè—"></button>
    </div>

    <div id="setupArea">
        <h2>ğŸ‡¯ğŸ‡µ æ—¥æ–‡æ‰“å­—ç·´ç¿’</h2>
        <div class="setup-group">
            <label>1. è²¼ä¸Šç·´ç¿’æ–‡ç« </label>
            <textarea id="sourceText" placeholder="è«‹åœ¨æ­¤è²¼ä¸Š...">ã‚ã„ã†ãˆãŠ ã‹ããã‘ã“ ã•ã—ã™ã›ã ãŸã¡ã¤ã¦ã¨ ãªã«ã¬ã­ã® ã¯ã²ãµã¸ã» ã¾ã¿ã‚€ã‚ã‚‚ ã‚„ã‚†ã‚ˆ ã‚‰ã‚Šã‚‹ã‚Œã‚ ã‚ã‚’ã‚“</textarea>
        </div>
        <div class="setup-group">
            <label>2. è¨­å®šæ™‚é–“é™åˆ¶ (åˆ†é˜)</label>
            <input type="number" id="timeSetting" value="1" min="0.5" step="0.5" placeholder="ä¾‹å¦‚ï¼š1">
        </div>
        <button class="btn btn-main" onclick="startGame()">é–‹å§‹ç·´ç¿’</button>
    </div>

    <div id="practiceArea" style="display:none;">
        <div class="status-bar">
            <span>â³ æ™‚é–“ï¼š<span id="timerDisplay">60</span> ç§’</span>
            <span>æ­£ç¢ºç‡ï¼š<span id="accDisplay">100%</span></span>
        </div>

        <div id="displayArea"><div id="textContainer"></div></div>
        
        <input type="text" id="inputField" placeholder="é»æ­¤é–‹å§‹è¼¸å…¥..." oninput="processInput()" autocomplete="off">
        
        <div class="btn-group">
            <button class="btn btn-retry" onclick="retryGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
            <button class="btn btn-edit" onclick="backToSetup()">âš™ï¸ ä¿®æ”¹è¨­å®š</button>
        </div>
    </div>
</div>

<script>
    let originalText = "";
    let timeLeft = 60;
    let timerInterval = null;
    let isPlaying = false;
    let hasStarted = false;

    function changeTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme === 'default' ? '' : theme);
    }

    function startGame() {
        originalText = document.getElementById('sourceText').value.trim();
        if(!originalText) return alert("è«‹å…ˆè²¼ä¸Šæ–‡ç« å…§å®¹ï¼");

        let min = parseFloat(document.getElementById('timeSetting').value);
        if(!min || min <= 0) min = 1;
        
        document.getElementById('setupArea').style.display = 'none';
        document.getElementById('practiceArea').style.display = 'block';

        resetGameLogic(min * 60);
    }

    function retryGame() {
        let min = parseFloat(document.getElementById('timeSetting').value);
        if(!min || min <= 0) min = 1;
        resetGameLogic(min * 60);
    }

    function resetGameLogic(seconds) {
        timeLeft = Math.floor(seconds);
        
        renderText();
        document.getElementById('timerDisplay').innerText = timeLeft;
        document.getElementById('accDisplay').innerText = "100%";
        
        const input = document.getElementById('inputField');
        input.value = "";
        input.disabled = false;
        input.focus();

        hasStarted = false; 
        isPlaying = true;
        if(timerInterval) clearInterval(timerInterval);
    }

    function renderText() {
        const container = document.getElementById('textContainer');
        container.innerHTML = "";
        originalText.split('').forEach((char, i) => {
            const span = document.createElement('span');
            span.innerText = char;
            if (i === 0) span.className = 'char-current';
            container.appendChild(span);
        });
        document.getElementById('displayArea').scrollTop = 0;
    }

    function processInput() {
        if(!isPlaying) return;

        if(!hasStarted) {
            hasStarted = true;
            startTimer();
        }

        const inputVal = document.getElementById('inputField').value;
        const spans = document.getElementById('textContainer').querySelectorAll('span');
        const displayArea = document.getElementById('displayArea');
        let correctCount = 0;

        spans.forEach((span, i) => {
            span.className = ''; 
            if (inputVal[i] == null) {
                if (i === inputVal.length) {
                    span.className = 'char-current';
                    const spanTop = span.offsetTop;
                    const areaHeight = displayArea.offsetHeight;
                    displayArea.scrollTop = spanTop - (areaHeight / 2) + 30; 
                }
            } else {
                if(inputVal[i] === span.innerText) {
                    span.className = 'char-correct';
                    correctCount++;
                } else {
                    span.className = 'char-wrong';
                }
            }
        });

        if(inputVal.length > 0) {
            let acc = Math.floor((correctCount / inputVal.length) * 100);
            document.getElementById('accDisplay').innerText = acc + "%";
        }

        if (inputVal.length >= originalText.length) {
            endGame("ğŸ‰ ç·´ç¿’å®Œæˆï¼");
        }
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timerDisplay').innerText = timeLeft;
            
            if(timeLeft <= 0) {
                endGame("â° æ™‚é–“åˆ°ï¼ç·´ç¿’çµæŸã€‚");
            }
        }, 1000);
    }

    function endGame(msg) {
        isPlaying = false;
        clearInterval(timerInterval);
        document.getElementById('inputField').disabled = true;
        setTimeout(() => {
            alert(msg);
        }, 100);
    }

    function backToSetup() {
        isPlaying = false;
        clearInterval(timerInterval);
        document.getElementById('practiceArea').style.display = 'none';
        document.getElementById('setupArea').style.display = 'block';
    }
</script>
</body>
</html>
