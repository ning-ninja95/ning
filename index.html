<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æ–‡æ‰“å­—å¤§å¸« - æ¥µé€Ÿç·´ç¿’</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --bg: #fdfaf4;
            --box: #ffffff;
        }
        body { font-family: "Helvetica Neue","Hiragino Sans","Yu Gothic","Meiryo",sans-serif; background-color: var(--bg); color: var(--primary); margin:0; padding:20px; display:flex; justify-content:center;}
        .container { width:100%; max-width:850px; background:var(--box); padding:40px; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.05);}
        h1 { text-align:center; margin-bottom:30px; }
        .stats-bar { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; margin-bottom:30px;}
        .stat-card { background:#f8f9fa; padding:15px; border-radius:10px; text-align:center; }
        #displayArea { font-size:28px; line-height:3.5; height:350px; overflow:hidden; position:relative; padding:20px; border:2px solid #eee; border-radius:12px; margin-bottom:25px;}
        .focus-line { position:absolute; top:28%; left:0; right:0; height:60px; background:rgba(44,62,80,0.03);}
        .char-correct { color:#dcdde1;}
        .char-wrong { background:#fab1a0; color:#d63031; border-radius:4px;}
        .char-current { background:#2c3e50; color:#fff; border-radius:4px; padding:0 4px;}
        #inputField { width:100%; height:70px; font-size:22px; padding:15px; border:3px solid #2c3e50; border-radius:10px;}
    </style>
</head>
<body>
<div class="container">
    <div id="setupArea">
        <h1>ğŸ‡¯ğŸ‡µ æ—¥æ–‡æ‰“å­—ç·´ç¿’å¤§å¸«</h1>
        <textarea id="sourceText" style="width:100%;height:160px;">ã‚ã„ã†ãˆãŠ ã‹ããã‘ã“ ã•ã—ã™ã›ã ãŸã¡ã¤ã¦ã¨ ãªã«ã¬ã­ã® ã¯ã²ãµã¸ã» ã¾ã¿ã‚€ã‚ã‚‚ ã‚„ã‚†ã‚ˆ ã‚‰ã‚Šã‚‹ã‚Œã‚ ã‚ã‚’ã‚“</textarea><br><br>
        <label>æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</label>
        <input type="number" id="timeSetting" value="1" step="0.5" min="0.5">
        <br><br>
        <button onclick="initGame()">é–‹å§‹ç·´ç¿’</button>
    </div>

    <div id="practiceArea" style="display:none;">
        <div class="stats-bar">
            <div class="stat-card">å‰©é¤˜æ™‚é–“<br><span id="timer">60</span></div>
            <div class="stat-card">å­—/åˆ†<br><span id="cpm">0</span></div>
            <div class="stat-card">æ­£ç¢ºç‡<br><span id="accuracy">100%</span></div>
        </div>
        <div id="displayArea">
            <div class="focus-line"></div>
            <div id="textContainer"></div>
        </div>
        <input id="inputField" oninput="processInput()" disabled>
    </div>
</div>

<script>
let originalText="", timeLeft=60, timerInterval, startTime=null, isPlaying=false;
const inputField=document.getElementById('inputField');

function initGame(){
    originalText=document.getElementById('sourceText').value.trim();
    timeLeft=Math.floor(parseFloat(document.getElementById('timeSetting').value)*60);
    document.getElementById('setupArea').style.display='none';
    document.getElementById('practiceArea').style.display='block';
    renderText();
    document.getElementById('timer').innerText=timeLeft;
    inputField.disabled=false;
    inputField.focus();
    isPlaying=true;
}

function renderText(){
    const c=document.getElementById('textContainer');
    c.innerHTML='';
    originalText.split('').forEach((ch,i)=>{
        const s=document.createElement('span');
        s.innerText=ch;
        if(i===0)s.className='char-current';
        c.appendChild(s);
    });
}

function processInput(){
    if(!isPlaying)return;
    if(!startTime){
        startTime=new Date();
        timerInterval=setInterval(()=>{
            timeLeft--;
            document.getElementById('timer').innerText=timeLeft;
            if(timeLeft<=0)endGame();
        },1000);
    }
    const input=inputField.value.split('');
    const spans=document.querySelectorAll('#textContainer span');
    let correct=0;
    spans.forEach((s,i)=>{
        s.className='';
        if(input[i]==null){
            if(i===input.length)s.className='char-current';
        }else if(input[i]===s.innerText){
            s.className='char-correct'; correct++;
        }else{
            s.className='char-wrong';
        }
    });
    const elapsed=(new Date()-startTime)/60000;
    document.getElementById('cpm').innerText=Math.floor(input.length/(elapsed||0.01));
    document.getElementById('accuracy').innerText=Math.floor(correct/(input.length||1)*100)+'%';
    if(input.length>=originalText.length)endGame();
}

function endGame(){
    clearInterval(timerInterval);
    isPlaying=false;
    inputField.disabled=true;
    alert('ç·´ç¿’çµæŸ');
}
</script>
</body>
</html>
