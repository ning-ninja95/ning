<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æ–‡æ‰“å­—ç·´ç¿’ - ä¿®æ­£æ²å‹•ç‰ˆ</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6485376162723745"
     crossorigin="anonymous"></script>

    <style>
        /* --- æ¨£å¼è¨­å®š --- */
        :root { --bg: #f0f2f5; --box: #ffffff; --primary: #34495e; --text: #2c3e50; --accent: #e74c3c; }
        [data-theme="matcha"] { --bg: #e6e6d1; --box: #fbfbf6; --primary: #556b2f; --text: #3e4a2e; }
        [data-theme="sakura"] { --bg: #f2e6e6; --box: #fffafa; --primary: #b35a6d; --text: #5d3a43; }
        [data-theme="blue"] { --bg: #dbe4eb; --box: #f5f9fc; --primary: #375a7f; --text: #20354b; }

        body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: var(--bg); margin: 0; padding: 0; transition: 0.3s; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .wrapper { display: flex; justify-content: center; width: 100%; max-width: 1400px; padding: 40px 10px; box-sizing: border-box; }
        .ad-sidebar { width: 160px; display: flex; flex-direction: column; padding-top: 60px; flex-shrink: 0; }
        .container { flex: 1; max-width: 800px; background: var(--box); padding: 40px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.05); margin: 0 30px; }
        
        .theme-panel { display: flex; justify-content: flex-end; margin-bottom: 20px; gap: 10px; }
        .color-btn { width: 28px; height: 28px; border-radius: 50%; border: 2px solid rgba(0,0,0,0.1); cursor: pointer; }
        .btn-default { background-color: #34495e; } .btn-matcha { background-color: #556b2f; }
        .btn-sakura { background-color: #b35a6d; } .btn-blue { background-color: #375a7f; }

        textarea, input[type="number"] { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #ddd; font-size: 16px; margin-bottom: 20px; outline: none; box-sizing: border-box; }
        
        /* é¡¯ç¤ºå€åŸŸæ¨£å¼ */
        #displayArea { 
            font-size: 28px; 
            line-height: 2.8; /* è¡Œé«˜è¨­å®š */
            height: 300px; 
            overflow: hidden; /* éš±è—è¶…å‡ºç¯„åœçš„æ–‡å­— */
            padding: 20px; 
            border: 2px solid rgba(0,0,0,0.05); 
            border-radius: 10px; 
            margin-bottom: 20px; 
            white-space: pre-wrap; 
            word-break: break-all; 
            background: var(--box); 
            position: relative; /* ç¢ºä¿æ²å‹•å®šä½æº–ç¢º */
        }

        .char-current { background: var(--primary); color: #fff; border-radius: 4px; }
        .char-correct { color: #bbb; } .char-wrong { background: var(--accent); color: white; border-radius: 4px; }
        #inputField { width: 100%; height: 60px; font-size: 24px; padding: 10px 15px; border: 2px solid var(--primary); border-radius: 8px; box-sizing: border-box; outline: none; }
        .btn-group { display: flex; gap: 15px; margin-top: 25px; }
        .btn { padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; background: var(--primary); color: white; transition: 0.2s; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        @media (max-width: 1100px) { .ad-sidebar { display: none; } .container { margin: 0; } }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="ad-sidebar">
        </div>

    <div class="container">
        <div class="theme-panel">
            <button class="color-btn btn-default" onclick="changeTheme('default')"></button>
            <button class="color-btn btn-matcha" onclick="changeTheme('matcha')"></button>
            <button class="color-btn btn-sakura" onclick="changeTheme('sakura')"></button>
            <button class="color-btn btn-blue" onclick="changeTheme('blue')"></button>
        </div>

        <div id="setupArea">
            <h2 style="text-align:center; color:var(--primary);">ğŸ‡¯ğŸ‡µ æ—¥æ–‡æ‰“å­—ç·´ç¿’</h2>
            <textarea id="sourceText" placeholder="åœ¨æ­¤è²¼ä¸Šç·´ç¿’æ–‡ç« ...">ã‚ã„ã†ãˆãŠ ã‹ããã‘ã“ ã•ã—ã™ã›ã ãŸã¡ã¤ã¦ã¨ ãªã«ã¬ã­ã® ã¯ã²ãµã¸ã» ã¾ã¿ã‚€ã‚ã‚‚ ã‚„ã‚†ã‚ˆ ã‚‰ã‚Šã‚‹ã‚Œã‚ ã‚ã‚’ã‚“</textarea>
            <label style="font-weight:bold; color:var(--primary);">è¨­å®šåˆ†é˜æ•¸ï¼š</label>
            <input type="number" id="timeSetting" value="1" min="0.5" step="0.5">
            <button class="btn" onclick="startGame()">é–‹å§‹ç·´ç¿’</button>
        </div>

        <div id="practiceArea" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-weight:bold; color:var(--primary); font-size: 1.1em;">
                <span>â³ <span id="timerDisplay">60</span> ç§’</span>
                <span>ğŸš€ é€Ÿåº¦ï¼š<span id="speedDisplay">0</span> å­—/åˆ†</span>
                <span>ğŸ¯ æ­£ç¢ºç‡ï¼š<span id="accDisplay">100%</span></span>
            </div>
            <div id="displayArea"><div id="textContainer"></div></div>
            <input type="text" id="inputField" placeholder="é»æ­¤é–‹å§‹è¼¸å…¥..." oninput="processInput()" autocomplete="off">
            <div class="btn-group">
                <button class="btn" onclick="retryGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
                <button class="btn" onclick="backToSetup()">âš™ï¸ ä¿®æ”¹è¨­å®š</button>
            </div>
        </div>
    </div>

    <div class="ad-sidebar">
        </div>
</div>

<script>
    let originalText = "", timeLeft = 60, totalTime = 60, timerInterval = null, isPlaying = false, hasStarted = false;
    
    function changeTheme(theme) { document.documentElement.setAttribute('data-theme', theme === 'default' ? '' : theme); }
    
    function startGame() {
        originalText = document.getElementById('sourceText').value.trim();
        if(!originalText) return alert("è«‹è²¼ä¸Šå…§å®¹");
        let min = parseFloat(document.getElementById('timeSetting').value) || 1;
        totalTime = Math.floor(min * 60);
        document.getElementById('setupArea').style.display = 'none';
        document.getElementById('practiceArea').style.display = 'block';
        resetGameLogic(totalTime);
    }
    
    function retryGame() { startGame(); }
    
    function resetGameLogic(seconds) {
        timeLeft = seconds; renderText();
        document.getElementById('timerDisplay').innerText = timeLeft;
        document.getElementById('accDisplay').innerText = "100%";
        document.getElementById('speedDisplay').innerText = "0";
        const input = document.getElementById('inputField'); input.value = ""; input.disabled = false; input.focus();
        hasStarted = false; isPlaying = true; if(timerInterval) clearInterval(timerInterval);
    }
    
    function renderText() {
        const container = document.getElementById('textContainer'); container.innerHTML = "";
        originalText.split('').forEach((char, i) => {
            const span = document.createElement('span'); span.innerText = char;
            if (i === 0) span.className = 'char-current'; container.appendChild(span);
        });
        document.getElementById('displayArea').scrollTop = 0;
    }
    
    // â˜… é‡é»ä¿®æ­£ï¼šprocessInput å‡½æ•¸ â˜…
    function processInput() {
        if(!isPlaying) return;
        if(!hasStarted) { hasStarted = true; startTimer(); }
        
        const inputVal = document.getElementById('inputField').value;
        const spans = document.getElementById('textContainer').querySelectorAll('span');
        const displayArea = document.getElementById('displayArea'); 
        let correctCount = 0;

        spans.forEach((span, i) => {
            span.className = '';
            if (inputVal[i] == null) {
                if (i === inputVal.length) {
                    span.className = 'char-current';
                    // --- é€™è£¡ä¿®æ­£äº†è‡ªå‹•æ²å‹•é‚è¼¯ ---
                    // è®“ç•¶å‰æ­£åœ¨æ‰“çš„é€™è¡Œå­—ï¼Œç›´æ¥æ²å‹•åˆ°é¡¯ç¤ºæ¡†çš„æœ€ä¸Šæ–¹
                    displayArea.scrollTop = span.offsetTop; 
                }
            } else {
                if(inputVal[i] === span.innerText) { span.className = 'char-correct'; correctCount++; }
                else { span.className = 'char-wrong'; }
            }
        });

        if(inputVal.length > 0) document.getElementById('accDisplay').innerText = Math.floor((correctCount / inputVal.length) * 100) + "%";
        updateSpeed(correctCount);
        if (inputVal.length >= originalText.length) endGame("ğŸ‰ ç·´ç¿’å®Œæˆï¼");
    }
    
    function updateSpeed(correctCount) {
        let timeElapsed = totalTime - timeLeft;
        if (timeElapsed <= 0) timeElapsed = 1;
        let cpm = Math.floor((correctCount / timeElapsed) * 60);
        document.getElementById('speedDisplay').innerText = cpm;
    }
    
    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--; document.getElementById('timerDisplay').innerText = timeLeft;
            const inputVal = document.getElementById('inputField').value;
            let correctCount = 0;
            const spans = document.getElementById('textContainer').querySelectorAll('span');
            for(let i=0; i<inputVal.length; i++) { if(inputVal[i] === spans[i]?.innerText) correctCount++; }
            updateSpeed(correctCount);
            if(timeLeft <= 0) endGame("â° æ™‚é–“åˆ°ï¼");
        }, 1000);
    }
    
    function endGame(msg) { isPlaying = false; clearInterval(timerInterval); document.getElementById('inputField').disabled = true; setTimeout(() => alert(msg), 100); }
    
    function backToSetup() { isPlaying = false; clearInterval(timerInterval); document.getElementById('practiceArea').style.display = 'none'; document.getElementById('setupArea').style.display = 'block'; }
</script>
</body>
</html>
